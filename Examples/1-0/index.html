<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Main Game</title>
    <style>
        #fDiv{
            border: 2px solid;
            border-radius: 18px;
            padding: 5px;
            border-color:lightseagreen;
        }
    </style>
</head>

<body>
    <p id="score" style="color:white;">Score : 0</p>
    <div id="mainDiv">
        <img src="./test.jpg" id="test" style="width: 100px;height: 100px;" />
        <img src="./test2.jpg" id="test2" style="width: 100px;height: 100px;" />
    </div>
    <div id="fDiv">

    </div>
</body>
<script src="../../jsha.js"></script>
<script>
    // Define Initialization Variables
    var keyCtrl = new keyController();
    var player = new gameObject("test");
    var enemy = new gameObject("test2");
    var pC = new pageController();
    var level = new number(1);
    var score = new number();
    var menu = new menuCreator("fDiv");
    var maxspeed = new number(1);

    // Set Location Of Player
    player.setL(pC.pageWidth / 2,pC.pageHeight / 5);

    // Make Background A Little Blur.
    pC.changeOpacity(50);
    // Another Way : 
    //    pC.half();

    // Initialize Movements ( W,A,S,D )
    keyCtrl.initMovement(player,maxspeed);

    // Making Menu
    menu.addOption("Start Game",run);
    menu.setAttribute("Start Game","id","runG");
    menu.setCSS("Start Game","color: white;");
    menu.addOption("About Us",function(){alert("This Game Created By MrArshiaHacker !")});
    menu.addOption("Exit Game",exit);
    menu.setCSS("Exit Game","color: white;");
    menu.setCSS("About Us","color: white;");

    // Set Background Color To Black
    pC.backcolor("black");

    // Showing Menu
    menu.setL(pC.pageWidth / 2,pC.pageHeight / 2 + 50);
    menu.addEventAll("mouseenter",enter);
    menu.addEventAll("mouseleave",leave);

    // Make A Music Player
    let music = new audioEventPlayer("runG");
    music.addEventPlayer("click",new audioPlayer("main.mp3"));
    music.addPlayer(new audioPlayer("lose.mp3"));

    // 2 Functions That Used For Menu ( mousehover ).
    function enter(e){
        e.target.style.color = "red";
    }
    function leave(e){
        e.target.style.color = "white";
    }

    // Decclare Interval Variable
    var mainG;

    // Run Game
    function run(){
        // Start Controlling Keyboard Buttons
        keyCtrl.control();
        // Make An Interval That Counts Level And Game Process
        var mainG = setInterval(inspect,100 / level.number);
        // Destroy The Menu
        menu.destroy();
        // Back Opacity Of Page To Normal.
        pC.changeOpacity(100);
        // Another Way : 
        //    pC.normal();
    }
    
    // Exit Game Function
    function exit(){
        document.getElementsByTagName("body")[0].remove()
    }

    var lose = false;

    // Game Process
    async function inspect(){
        // Get Direction And Check That Which Direction Enemy Should Go.
        let d = enemy.getDirection(player);
        if(d.x > 0){
            enemy.moveX(1);
        }
        else if(d.x < 0){
            enemy.moveX(-1);
        }
        if(d.y > 0){
            enemy.moveY(-1);
        }
        else if(d.y < 0){
            enemy.moveY(1);
        }

        // Spawn In Other Side Of Page If Player Colliding To Walls.
        if(player.getLocation().y > (pC.pageHeight)){
            player.setY(pC.pageHeight);
        }
        else if(player.getLocation().y < 0){
            player.setY(0);
        }
        if(player.getLocation().x > (pC.pageWidth - player.object.width)){
            player.setX(0);
        }
        else if(player.getLocation().x < 0){
            player.setX(pC.pageWidth - player.object.width);
        }

        // Check If enemy And Player Have Collision Or Not.
        // If They Have, User Has Been Lost.
        if(player.collisionTo(enemy.object)){
            // Clear Interval For Game Process
            clearInterval(mainG);
            // Stop Music
            // Write 'You Lose' In Page.
            if(!lose){
                document.write("<center><h1 style='color:red;'>You Lose !</h1></center>")
                // Stop Main Music And Play 
                music.players["main.mp3"].stop()
                music.players["lose.mp3"].play()
            }
            lose = true;
            // Wait 1 Second.
            await sleep(5000);
            // Restart The Game ( jsha Internal Function )
            restart();
        }
        // Increase Score If User Didnt Lost.
        score.increase(0.01);

        // Update Score And Level.
        if(parseInt(score.number) == level.number){
            level.increase(1);
            $("score").innerHTML = "Score : " + level.number;
            maxspeed.increase(0.1);
            clearInterval(mainG);
            mainG = setInterval(inspect,100 / level.number + ((100 / level.number) / 2));
        }
    }
    
</script>

</html>